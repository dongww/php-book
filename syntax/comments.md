#PHP 注释

只要是一门正儿八经的编程语言，都会提供给开发者注释的语法。或许你尚未意识到注释的重要性，甚至从来不写注释，
但至少也应该从前面这个事实意识到，注释这个功能在编程领域是不可或缺的。而且，越是身经百战的程序员，对这点的认识越是深刻。
我个人无法想象如果 PHP 没有添加注释的能，我是否能把一个项目持续地做下去，以及能做到什么程度。

注释最基本的用途是可以让你为某个局部的代码或者某个文件甚至整个项目注上说明。良好的注释可以使你回头再来阅读这段代码的时候，立马就能唤起已经中断的思绪。
如果是团队协作开发一个项目，注释就显得更加重要。良好的注释不至于让你的队友花上半天时间通读代码以后才明白你的意图。

##什么是良好的注释

**一目了然**

好的注释能让人望文生义，使读者迅速明白作者的意图，并对主要功能和关键信息有一个大概的了解。

**恰如其分**

归纳起来有以下几点：

* 在合适的地方添加注释
* 恰当的详细程度

要做到这几点，对专业技能的要求其实并不高，无非就是掌握一些语法和规范。但对作者的专业素养以及经验的要求就很高了。
注释的质量的确需要长期的经验积累才能逐渐提高，我的建议是，经常阅读高质量的代码，学习高手是如何添加注释的，从照瓢画葫芦开始。

**良好并一致的风格**

这完全是态度问题了。

随着 PHP 越来越标准化，代码的风格的选择余地其实很小。我们所要在的，就是认认真真地在项目中遵行一致的风格，无论是个人项目还是团队开发，无论项目的大小。
虽然现在的 IDE 越来越智能，可以辅助你很好地实现这一点，但我们在态度上绝对不能产生依赖性。

##演示代码

我们试着将之前的 `tags01.php` 的代码加上注释：

~~~ .php

<?php
/**
 * 文件 comments01.php，用于处理日程列表的数据。
 *
 * @copyright Copyright (c) 2014 dongww <dongww@gmail.com>
 */

/**
 * 获得当天的日期，返回格式为 “年（4位）-月（2位）-日（2位）”
 *
 * @return string
 */
function today()
{
    $today = new DateTime();

    return $today->format('Y-m-d');
}

/**
 * 日程列表的数据
 *
 * @var array $todoList
 */
$todoList = [
    '09:00' => '调试代码',
    '14:00' => '完成 UML 制图',
    '17:00' => '下班去买菜',
];

//包含视图文件，并执行
require_once 'tags01_view.php';

~~~

##注释的进化

我们在演示代码中看到了几个注释片段，顶部的注释一般用来描述该文件的总体信息和版权信息。其他局部的注释一般加在要说明的代码上方。
`today()` 函数的注释说明了该函数的用途，以及数据的返回类型。`$todoList` 变量的注释说明了该变量的用途，以及该变量的类型。

但随着技术的发展和经验的累积，一些天才异想天开，觉得是不是能利用注释来做更多的事呢？于是他们真的发明了一些很神奇的用法，大幅提升了开发人员的效率。
可见异想天开并不是什么坏事，人类的进步往往源自于异想天开。

目前，代码的注释被用来自动生成文档和自动生成代码已经极为普遍，作为一项专业技能，我们非常有必要来了解一下。

###自动生成文档

演示代码中的注释我们使用了 `/** */` 这样的格式，PHP 本身并没有要求我们必须使用这样的格式，但这种写法已经成为了事实上的标准。
以这样的格式来书写注释，有助于一些文档生成工具进行识别，进而根据注释内容自动生成完整的 API 文档。
换句话说，我们在为代码添加注释的同时，其实已经在编写文档了。多么神奇啊！

当然，如果希望自己的代码能生成高质量的文档，还需要了解一些额外的知识。例如，如何标记函数的返回值、参数、类型等等。
在我们的注释中，已经加入了一些这样的标记，例如： `@return string` 指明 `today` 将返回一个字符串；
`@var array $todoList` 指明 `$todoList` 变量是数组类型。

学习这些额外知识的负担并不大，但是回报巨大，所以建议大家能多多了解。本文的目的是抛砖引玉，并不打算对所有的知识加以详细说明。
你可以参考 [phpDocumentor](http://www.phpdoc.org/)，来进一步深入学习。上面也有生成后的 API 文档演示。

###自动生成代码、执行代码

除了用于生成文档，注释还有一些更高级的功能。例如 [Doctrine ORM](http://www.doctrine-project.org/)中，
就大量地使用了该项技术。这是一个操作数据库的封装类库，可以将“类”映射到数据库表，以便开发者用面向对象的方式来思考和操作数据库。
关于面向对象的知识我们会在后续章节详细探讨。目前只需要大概了解一下，主要目的还是为了说明注释的用途。

我们来看一段基于 Doctrine ORM 的代码：

~~~ .php

<?php
/**
 * @Entity @Table(name="products")
 **/
class Product
{
    /** @Id @Column(type="integer") @GeneratedValue **/
    protected $id;
    /** @Column(type="string") **/
    protected $name;

    // .. (其他代码)
}

~~~

这里定义了一个“产品类”，其包含两个属性，`id` 以及 `name`。我们可以在代码中实例化一个对象，并通过其提供的方法来获取数据的值。
比如想要获取某个产品的名称：

~~~ .php

/** @var Product $product */
//$product = ...

$productName = $product->getName();

~~~

当然，重点不在于此，而在于，到底这个 `$product` 对象是如何同数据库关联起来并且获取数据库中数据的呢？
这里面最大的功臣当属于类定义文件中的特定注释，注释中指明了该类对应的数据库表，以及某个属性对应的数据库字段和字段类型。
Doctrine ORM 会解析注释，用于自动生成数据库表，以及同数据库进行映射和关联，就像变魔术一样！